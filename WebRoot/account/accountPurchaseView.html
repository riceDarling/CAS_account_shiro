
 <link href="bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">

 <script src="bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
 <script src="bootstrap-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
 <script src="lib/js/purchaseForm.js"></script>

<div class="col-md-12">
	<div class="panel">
		<div class="panel-heading">
				<h3 class="panel-title">
					订货申请单
				</h3>
		</div>
		<div class="panel-body">
		<form class="form-horizontal cascade-forms" method="post" action="#" name="" id="signup_form" novalidate="novalidate">
				<div class="form-group" style="display:none">
					<label class="col-lg-1 col-md-1 control-label">id</label>
					<div class="col-lg-4 col-md-3">
						<input type="text" class="form-control form-cascade-control input-small" name="id" id="id" readonly="readonly">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-1 col-md-1 control-label">标题：</label>
					<div class="col-lg-4 col-md-3">
						<input type="text" class="form-control form-cascade-control input-small" name="title" id="title" readonly="readonly">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-1 col-md-1 control-label">询价单号：</label>
					<div class="col-lg-4 col-md-3">
						<input type="text" class="form-control form-cascade-control input-small" name="inquirynum" id="inquirynum" readonly="readonly">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-6 col-md-6 control-label"><h3>订货单详细</h3></label>
					<div class="col-lg-12 col-md-12">
						<table class="table table-striped" id="">
							<thead>
								<tr>
									<th>供应商名称</th>
									<th>物资名称</th>
									<th>包装方式</th>
									<th>运输方式</th>
									<th>运费金额</th>
									<th>单价</th>
									<th>数量</th>
									<th>预计到货日期</th>
									<th>总价</th>
									<th>备注信息</th>
								</tr>
								</thead>
								<tbody id="accountPurchaseDetailList">
								
								</tbody>
						</table>
												
					</div>	
				</div> 
				
				<div class="form-group">
					<label class="col-lg-6 col-md-6 control-label"><h3>供应商明细</h3></label>
					<div class="col-lg-12 col-md-12">
						<table class="table table-striped" id="">
							<thead>
								<tr>
									<th>供应商名称</th>
									<th>付款期限</th>
									<th>付款方式</th>
								</tr>
								</thead>
								<tbody id="supplierList">
								
								</tbody>
						</table>
												
					</div>	
				</div> 
			</form>
		</div>
		<div class="panel-body ">
			<table class="table table-striped" id="accountPurchaseView_act_table">
				<thead>
					<tr>
						<th>申请人</th>
						<th>审核人</th>
						<th>开始时间</th>
						<th>结束时间</th>
						<th>结论</th>
						<th>意见</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		
	</div>
</div>

<script>
	var accountPurchaseView_id=$.cookie("accountPurchaseView_id");
	
	//根据订货单id获取询价单字表列表
	$.ajax("http://"+IP_config+"/account/accountPurchase/formView", {
		dataType: "json",
		xhrFields: {
			withCredentials: true
		},
		type: "GET",
		data:{
			"accountPurchaseid":accountPurchaseView_id
		},
		success: function(data) {
			//console.log(data);
			if(data.success){
				//获取成功
				//layer.alert(data.msg);
				if(data.obj!=null){
					$("#id").val(data.obj.purchase.id);
					$("#title").val(data.obj.purchase.title);
					$("#inquirynum").val(data.obj.purchase.inquirynum);
					
					if(data.obj.purchase.accountPurchaseDetailList.length>0){
						var html="";
						for (i in data.obj.purchase.accountPurchaseDetailList) {
							html+='<tr><td>';
								var detail = data.obj.purchase.accountPurchaseDetailList[i];
							html+=detail.supplier+'</td><td>';	
							html+=detail.materialname+'</td><td>';
							html+=detail.packways+'</td><td>';
							html+=detail.transports+'</td>';
							html+='<td>'
								+detail.freightfee
								+'</td>'
								+'<td>'
								+detail.unitprice
								+'</td>'
								+'<td>'
								+detail.quantity
								+'</td>'
								+'<td>'
								+detail.receivedate
								+'</td>'
								+'<td>'
								+detail.totlemoney
								+'</td>'
								+'<td>'
								+detail.remarks
								+'</td>';
								
							html+='</tr>';
						}
							$("#accountPurchaseDetailList").html(html); 
					}
					//供应商列表
					if(data.obj.purchase.supplierList.length>0){
						var html="";
						for (i in data.obj.purchase.supplierList) {
							html+='<tr>'
								+'<td>'
								+data.obj.purchase.supplierList[i].supplier
								+'</td>'
								+'<td>'
								+data.obj.purchase.supplierList[i].deadline
								+'</td>'
								+'<td>'
								+data.obj.purchase.supplierList[i].payways
								+'</td>'
								+'	</tr>';
						}
						$("#supplierList").html(html); 
					}
					//流程节点列表
					if(data.obj.actlist.length>0){
						var html="";
						for (i in data.obj.actlist) {
							var act = data.obj.actlist[i];
							html += '<tr><td>'
									+ act.requisitionName + '</td>' + '<td>'
									+ act.checkerName + '</td>' + '<td>'
									+ formatDateTime(act.start_time) + '</td>' + '<td>';
									if(act.end_time!=null){
										html+= formatDateTime(act.end_time) + '</td>' + '<td>';
									}else{
										html+='</td>' + '<td>';
									}
								
									if(act.conclusion==1){
										html+='同意</td>' + '<td>';
									}else if(act.conclusion==0){
										html+='不同意</td>' + '<td>';
									}else {
										html+='</td>' + '<td>';
									}
									
									html+= act.remarks + '</td>' + '</tr>';
						}
						$("#accountPurchaseView_act_table").html(html); 
					}
					
				}
				
			}else{
				//获取失败提示
				layer.alert(data.msg);
			}
		}
	
	});
	

	
</script>

