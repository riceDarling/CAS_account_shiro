
 <link href="bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">

 <script src="bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
 <script src="bootstrap-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>

<div class="col-md-12">
	<div class="panel">
		<div class="panel-heading">
			<h3 class="panel-title">添加询价记录</h3>
		</div>
		<div class="panel-body">
			<form class="form-horizontal cascade-forms" method="post" action="#" name="" id="" novalidate="novalidate">
				
				<div class="form-group">
					<label class="col-lg-2 col-md-3 control-label">物资名称：</label>
					<div class="col-lg-4 col-md-3">
						<select tabindex="1" name="materialname" id="materialname" class="form-control">
							<option value=""></option>

						</select>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-2 col-md-3 control-label">供应商名称：</label>
					<div class="col-lg-4 col-md-3">
						<select tabindex="1" name="supplier" id="supplier" class="supplier form-control">
							<option value=""></option>

						</select>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-2 col-md-3 control-label">规格型号：</label>
					<div class="col-lg-4 col-md-3">
						<input type="text" class="form-control  form-control" name="size" id="size" readonly="readonly">
					</div>
				</div>
				
				
				<div class="form-group">
					<label class="col-lg-2 col-md-3 control-label">计量单位：</label>
					<div class="col-lg-4 col-md-3">
						<select tabindex="1" name="unit" id="unit" class="unit_select form-control">
							<option value=""></option>

						</select>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-2 col-md-3 control-label">询价有效期限：</label>
					<div class="col-lg-4 col-md-3">
						<input size="16" type="text" value="" readonly
							class="form_datetime form-control" id="validdate">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-2 col-md-3 control-label">单价(保留两位)：</label>
					<div class="col-lg-4 col-md-3">
						<input type="text" class="form-control  input-small form-control" name="unitprice" id="unitprice">
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-2 col-md-3 control-label">付款方式：</label>
					<div class="col-lg-4 col-md-3">
						<select tabindex="1" name="payway" id="payway" class="payway form-control">
							<option value=""></option>

						</select>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-lg-2 col-md-3 control-label">备注信息：</label>
					<div class="col-lg-4 col-md-3">
						<input type="text" class="form-control  form-control" name="remarks" id="remarks">
					</div>
				</div>
				
				
			
			<!-- 	<div class="form-group">
					<label class="col-lg-2 col-md-3 control-label">审核人：</label>
					<div class="col-lg-4 col-md-3">
					
					</div>
				</div> -->
				<div class="form-actions">
					<input type="button" value="提交" class="btn bg-primary text-white btn-sm" id="detail_save">
				</div>
			</form>
		</div>

	</div>
</div>

<script>
$("#materialname").change(function(){
	//alert($("#materialname option:selected").attr("materialsize"));
	$("#size").val($("#materialname option:selected").attr("materialsize"));
});
$("#detail_save").click(function(){

	var json_data={
		"inquirydetailnum" : accountInquiryDetailForm_id,
		"ordernum":accountInquiryDetailForm_id,
		"supplier":$("#supplier").val(),
		"materialname":$("#materialname").val(),
		"validdate":$("#validdate").val(),
		"size":$("#size").val(),
		"unit":$("#unit").val(),
		"unitprice":$("#unitprice").val(),
		"materialcode":$("#materialname option:selected").attr("materialnum"),
		"suppliercode":$("#supplier option:selected").attr("supplierNum"),
		"remarks":$("#remarks").val()
	};
	//console.log(data);
	
	 $.ajax("http://" + IP_config + "/account/accountInquiry/saveDetail", {
		dataType : "json",
		data:json_data,
		xhrFields : {
			withCredentials : true
		},
		type : "POST",
		success : function(data) {
			//console.log(data);
			if (data.success) {
				//保存成功
				layer.alert(data.msg);
				$("#index_content").load("accountInquiryList.html");
			} else {
				//保存失败提示
				layer.alert(data.msg);
			}
		}
	}); 
});
$(".form_datetime").datetimepicker({
	language:  'zh-CN', 
	minView: "month", //选择日期后，不会再跳转去选择时分秒 
    format: 'yyyy-mm-dd',
    todayBtn:  1,
    autoclose: 1,});
    
var accountInquiryDetailForm_id=$.cookie("accountInquiryDetailForm_id");
//获取要询价的物资列表
$.ajax("http://" + IP_config + "/account/accountInquiry/requisition", {
	dataType : "json",
	data : {
		"accountInquiryid" : accountInquiryDetailForm_id
	},
	xhrFields : {
		withCredentials : true
	},
	type : "POST",
	success : function(data) {
		//console.log(data);
		if (data.success) {
			//获取成功
			//layer.alert(data.msg);
			if(data.obj.length>0){
				var html='<option value=""></option>';
				for(i in data.obj){
					var obj=data.obj[i];
					html+='<option value="'+obj.materialName+'" materialnum="'+obj.materialNum+'" materialsize="'+obj.size+'">'+obj.materialName+'</opption>';
				}
				$("#materialname").html(html);
			}
		
		} else {
			//获取信息提示
			layer.alert(data.msg);
		}
	}
});

//计量单位
var units;
$.ajax("http://"+IP_config+"/account/paraInfo/getParaInfoList", {
	dataType: "json",
	xhrFields: {
		withCredentials: true
	},
	data:{
		"pId":3
	},
	type: "POST",
	success: function(data) {
		//console.log(data);
		if(data.success){
			//获取成功
			//layer.alert(data.msg);
			units=data.obj;
			var html="<option value=''></option>";
			for (i in data.obj) {
				var unit = data.obj[i];
				html+='<option value="'+unit.id+'">'+unit.name+'</option>';
			}
			$(".unit_select").html(html);
		}else{
			//获取失败提示
			layer.alert(data.msg);
		}
	}
});

//付款方式
var payways;
$.ajax("http://"+IP_config+"/account/paraInfo/getParaInfoList", {
	dataType: "json",
	xhrFields: {
		withCredentials: true
	},
	data:{
		"pId":5
	},
	type: "POST",
	success: function(data) {
		//console.log(data);
		if(data.success){
			//获取成功
			//layer.alert(data.msg);
			units=data.obj;
			var html="<option value=''></option>";
			for (i in data.obj) {
				var unit = data.obj[i];
				html+='<option value="'+unit.id+'">'+unit.name+'</option>';
			}
			$(".payway").html(html);
		}else{
			//获取失败提示
			layer.alert(data.msg);
		}
	}
});

//供应商
var payways;
$.ajax("http://"+IP_config+"/account/supplier/findAllList", {
	dataType: "json",
	xhrFields: {
		withCredentials: true
	},
	type: "POST",
	success: function(data) {
		//console.log(data);
		if(data.success){
			//获取成功
			//layer.alert(data.msg);
			units=data.obj;
			var html="<option value=''></option>";
			for (i in data.obj) {
				var supplier = data.obj[i];
				html+='<option value="'+supplier.supplier+'" supplierNum="'+supplier.supplierNum+'">'+supplier.supplier+'</option>';
			}
			$(".supplier").html(html);
		}else{
			//获取失败提示
			layer.alert(data.msg);
		}
	}
});
</script>