 <!-- Loading Bootstrap -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/dataTables.bootstrap.css" rel="stylesheet">

<script type="text/javascript" src="../js/jquery-2.1.1.min.js"></script>
<script src="lib/layer/layer.js"></script>
<script src="lib/js/config.js"></script>

<div class="col-md-12">
	<div class="panel">
		<div class="panel-heading">
				<h3 class="panel-title">
					询价报表
				</h3>
		</div>
		<div class="panel-body">
			<table class="table table-bordered table-condensed table-hover"
				id="accountInquirydetail_example">
				<thead>
					<tr>
						<th>#</th>
						<th>询价时间</th>
						<th>物资名称</th>
						<th>供应商名称</th>
						<th>规格型号</th>
						<th>单价</th>
						<th>备注</th>
					</tr>
				</thead>
				<tbody>
					
				</tbody>
			</table>
		</div>
		
		<div class="panel-body">
			<label class="col-lg-2 col-md-3 control-label">审核人：</label>
			<div class="col-lg-4 col-md-3">
				<select  tabindex="1" name="checker" id="accountInquirydetail_checker" class="form-control">
					 <option value=""></option>
                   						
				 </select>	
			</div>
		</div>
		<div class="panel-body">
			<input type="button" value="提交" class="btn bg-primary text-white btn-sm" id="accountInquirydetail_addbtn">
		</div>
	</div>
</div>

<script>
$.ajax("http://"+IP_config+"/account/admin/getAdminList", {
	dataType: "json",
	xhrFields: {
		withCredentials: true
	},
	type: "POST",
	success: function(data) {
		//console.log(data);
		if(data.success){
			//获取成功
			//layer.alert(data.msg);
			var html="<option value=''></option>";
			for (i in data.obj) {
				var admin = data.obj[i];
				html+='<option value="'+admin.id+'">'+admin.username+'</option>';
			}
			$("#accountInquirydetail_checker").html(html);
		}else{
			//获取失败提示
			layer.alert(data.msg);
		}
	}
});

function GetQueryString(name)
{
     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
     var r = window.location.search.substr(1).match(reg);
     if(r!=null)return  unescape(r[2]); return null;
};
var accountInquiryList_id=GetQueryString("accountInquiryList_id");

	$.ajax("http://" + IP_config + "/account/accountInquiry/detail", {
		dataType : "json",
		data : {
			"accountInquiryid" : accountInquiryList_id
		},
		xhrFields : {
			withCredentials : true
		},
		type : "POST",
		success : function(data) {
			//console.log(data);
			if (data.success) {
				//获取成功
				//layer.alert(data.msg);
				if(data.obj.length>0){
					var html="";
					for(i in data.obj){
						var obj=data.obj[i];
						html+='<tr><td>'
						+'<input type="checkbox"  name="idxk" value="'+obj.id+'">'
						+'</td><td>';
						if(obj.createDate!=null){
							html+=formatDateTime(obj.createDate)+'</td><td>'
						}else{
							html+='</td><td>'
						}	
						html+=obj.materialname+'</td><td>'
						+obj.supplier+'</td><td>'
						+obj.size+'</td><td>'
						+obj.unitprice+'</td><td>';
						if(obj.remarks!=null){
							html+=obj.remarks;
						}else{
						}	
						html+='</td></tr>';
					}
					$("#accountInquirydetail_example tbody").html(html);
				}
			
			} else {
				//获取信息提示
				layer.alert(data.msg);
			}
		}
	});
	$("#accountInquirydetail_addbtn").click(function(){
		var detail_list=new Array();
		$("#accountInquirydetail_example>tbody>tr").each(function(){
			if($(this).children("td:first").children(":checkbox").is(":checked")){
				var inquirydetailId=$(this).children("td:first").children(":checkbox").val();
				detail_list.push(inquirydetailId);
			}
		});
		
		$.ajax({
			url:"http://"+IP_config+"/account/accountInquiry/detailupdata",
			type:"post",
			async:false,
			data:{
				"inquirydetailId":detail_list,
				"checker":$("#accountInquirydetail_checker").val()
			},
			success:function(data){
				if(data.success){
					//提交成功
					$("#index_content",window.parent.document).load("actTaskHistoricList.html");
					//关闭页面
					$(".layui-layer-shade",window.parent.document).remove();
					$(".layui-layer-iframe",window.parent.document).remove();
				}else{
					//获取失败提示
					layer.alert(data.msg);
				}
			}
		}); 
		//alert(accountInquiryRequisition_id);
		
	});
</script>