 <!-- Loading Bootstrap -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/dataTables.bootstrap.css" rel="stylesheet">

<script type="text/javascript" src="../js/jquery-2.1.1.min.js"></script>
<script src="lib/layer/layer.js"></script>
<script src="lib/js/config.js"></script>

<div class="col-md-12">
	<div class="panel">
		<div class="panel-heading">
				<h3 class="panel-title">
					询价报表
				</h3>
		</div>
		<div class="panel-body">
			<table class="table table-bordered table-condensed table-hover"
				id="accountInquirydetail_example">
				<thead>
					<tr>
						<th>#</th>
						<th>询价时间</th>
						<th>物资名称</th>
						<th>供应商名称</th>
						<th>规格型号</th>
						<th>单价</th>
						<th>备注</th>
					</tr>
				</thead>
				<tbody>
					
				</tbody>
			</table>
		</div>
		
		<div class="panel-body">
			<label class="col-lg-2 col-md-3 control-label">状态：</label>
			<div class="col-lg-4 col-md-3">
				<input type="radio" class="square-input" name="iCheck4" onclick="setreadlay(0)">&nbsp;申请
          		<input type="radio" class="square-input" name="iCheck4" onclick="setreadlay(1)">&nbsp;订货
			</div>
		</div>
		
		<div class="panel-body">
			<label class="col-lg-2 col-md-3 control-label" id="accountInquirydetail_checker_label">审核人：</label>
			<div class="col-lg-4 col-md-3">
				<select  tabindex="1" name="checker" id="accountInquirydetail_checker" class="form-control">
					 <option value=""></option>
                   						
				 </select>	
			</div>
		</div>
	
							<div class="panel-body">
								<label class="col-lg-2 col-md-3 control-label">意见：</label>
								<div class="col-lg-10 col-md-9">
									<textarea class="form-control form-cascade-control" rows="3" id="accountInquirydetail_comment"></textarea>
								</div>
							</div>
						
							<div class="panel-body">
								 <a href="#" class="btn btn-success btn-sm btn-animate-demo" id="requisitionAudit_next" onclick="audit_submit('yes')">同意</a>
								 <a href="#" class="btn btn-warning btn-sm btn-animate-demo" id="requisitionAudit_previous" onclick="audit_submit('no')">驳回</a>
								 <a href="#" class="btn btn-primary btn-sm btn-animate-demo" id="requisitionAudit_end" style="display:none" onclick="audit_submit('end')">完成</a>
							</div>

	</div>
</div>

<script>

function setreadlay(state){
	if(state==0){
		$("#accountInquirydetail_checker_label").text("审核人:");
		$("#requisitionAudit_previous").show();
		$("#requisitionAudit_next").show();
		$("#requisitionAudit_end").hide();
	}else{
		$("#accountInquirydetail_checker_label").text("订货人:");
		$("#requisitionAudit_previous").hide();
		$("#requisitionAudit_next").hide();
		$("#requisitionAudit_end").show();
	}
};


$.ajax("http://"+IP_config+"/account/admin/getAdminList", {
	dataType: "json",
	xhrFields: {
		withCredentials: true
	},
	type: "POST",
	success: function(data) {
		//console.log(data);
		if(data.success){
			//获取成功
			//layer.alert(data.msg);
			var html="<option value=''></option>";
			for (i in data.obj) {
				var admin = data.obj[i];
				html+='<option value="'+admin.id+'">'+admin.username+'</option>';
			}
			$("#accountInquirydetail_checker").html(html);
		}else{
			//获取失败提示
			layer.alert(data.msg);
		}
	}
});

function GetQueryString(name)
{
     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
     var r = window.location.search.substr(1).match(reg);
     if(r!=null)return  unescape(r[2]); return null;
};
var accountInquiryList_id=GetQueryString("accountInquiryList_id");

	$.ajax("http://" + IP_config + "/account/accountInquiry/detailEnd", {
		dataType : "json",
		data : {
			"accountInquiryid" : accountInquiryList_id
		},
		xhrFields : {
			withCredentials : true
		},
		type : "POST",
		success : function(data) {
			//console.log(data);
			if (data.success) {
				//获取成功
				//layer.alert(data.msg);
				if(data.obj.length>0){
					var html="";
					for(i in data.obj){
						var obj=data.obj[i];
						html+='<tr><td>'
						+i+'</td><td>';
						if(obj.createDate!=null){
							html+=formatDateTime(obj.createDate)+'</td><td>';
						}else{
							html+='</td><td>';
						}	
						html+=obj.materialname+'</td><td>'
						+obj.supplier+'</td><td>'
						+obj.size+'</td><td>'
						+obj.unitprice+'</td><td>';
						if(obj.remarks!=null){
							html+=obj.remarks;
						}else{
						}	
						html+='</td></tr>';
					}
					$("#accountInquirydetail_example tbody").html(html);
				}
			
			} else {
				//获取信息提示
				layer.alert(data.msg);
			}
		}
	});
	
	function audit_submit(conclusion){
		//alert(conclusion);
		//alert($("#requisitionAudit_checker").val());
		
		$.ajax("http://"+IP_config+"/account/accountInquiry/saveAudit", {
			dataType: "json",
			data:{
				"id":accountInquiryList_id,
				"conclusion":conclusion,
				"checker":$("#accountInquirydetail_checker").val(),
				"comment":$("#accountInquirydetail_comment").val()
			},
			xhrFields: {
				withCredentials: true
			},
			type: "POST",
			success: function(data) {
				//console.log(data);
				if(data.success){
					//获取成功
					//提交成功
					$("#index_content",window.parent.document).load("actTaskHistoricList.html");
					//关闭页面
					$(".layui-layer-shade",window.parent.document).remove();
					$(".layui-layer-iframe",window.parent.document).remove();
				}else{
					//获取失败提示
					layer.alert(data.msg);
				}
			}
		});
	};

</script>